---
import { getCollection } from "astro:content";
import { getLangFromUrl, useTranslations } from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const posts = (await getCollection("blog"))
    .filter((post) => post.data.lang === lang)
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<section class="blog container">
    <div class="header">
        <h2>{t("blog.title")}</h2>
        <p>{t("blog.description")}</p>
    </div>
    <div class="post-grid">
        {
            posts.map((post) => (
                <article class="post-card glass hover-lift">
                    <span class="date">
                        {post.data.pubDate.toLocaleDateString(lang)}
                    </span>
                    <h3>{post.data.title}</h3>
                    <p>{post.data.description}</p>
                    <div class="tags">
                        {post.data.tags?.map((tag) => (
                            <span class="tag">#{tag}</span>
                        ))}
                    </div>
                    <a href={`/${lang}/construction`} class="read-more">
                        Leer más <span>→</span>
                    </a>
                </article>
            ))
        }
    </div>
</section>

<style>
    .blog {
        padding: 80px 2rem;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .header {
        margin-bottom: 4rem;
    }

    h2 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
    }

    .post-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 2rem;
    }

    .post-card {
        padding: 2rem;
        border-radius: 2rem;
        display: flex;
        flex-direction: column;
    }

    .date {
        font-size: 0.8rem;
        color: var(--accent-primary);
        font-weight: 600;
        margin-bottom: 1rem;
    }

    h3 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
    }

    .post-card p {
        color: var(--text-secondary);
        line-height: 1.6;
        margin-bottom: 2rem;
        flex-grow: 1;
    }

    .tags {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
    }

    .tag {
        font-size: 0.75rem;
        color: var(--text-secondary);
    }

    .read-more {
        font-weight: 600;
        color: var(--accent-primary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
</style>
